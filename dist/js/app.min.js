function startVegan2map(){ko.applyBindings(app=new AppViewModel)}var City=function(e,t){this.lat=e,this.lng=t},Google=function(){this.map="",this.markerList=[],this.addmarker=function(e){this.markerList.push(e)}},Resturant=function(e,t,o,n,r,a,i,s,l){this.name=e,this.marker=t,this.info=o,this.infoWindow=a,this.rating=n,this.locationImg=r,this.fourSquareData=[],this.updatefourSquareData=function(e,t,o){this.fourSquareData.push({category:o,phone:e,homepage:t})}},AppViewModel=function(){function e(){try{t.google=new Google,t.google.map=new google.maps.Map(document.getElementById("map"),{zoom:10,center:t.currentCity,styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#8dc04a"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{gamma:.01},{lightness:20}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{saturation:-31},{lightness:-33},{weight:2},{gamma:.8}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{lightness:30},{saturation:30}]},{featureType:"poi",elementType:"geometry",stylers:[{saturation:20}]},{featureType:"poi.park",elementType:"geometry",stylers:[{lightness:20},{saturation:-20}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:10},{saturation:-30}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{saturation:25},{lightness:25}]},{featureType:"water",elementType:"all",stylers:[{lightness:-20}]}]})}catch(e){$("#map-error").text("GoogleMap could not be loaded"),alert("could not load googlemap with error : "+e)}t.apiGetPlaces(t.currentCity,t.google.map,function(e,o){if(o===google.maps.places.PlacesServiceStatus.OK){t.bounds=new google.maps.LatLngBounds;var n=new google.maps.InfoWindow;ko.utils.arrayForEach(e||[],function(e){var o;t.google.addmarker(o=new google.maps.Marker({position:e.geometry.location,map:t.google.map,title:e.title,animation:google.maps.Animation.DROP}));var r="https://maps.googleapis.com/maps/api/streetview?size=300x150&location="+e.geometry.location.lat()+","+e.geometry.location.lng()+"&heading=151.78&pitch=-0.76&key=AIzaSyAMr4cPC9-zPpNLCk1yngw1ijaFQ2z-rxM",a='<div class="content"><h1>'+e.name+"</h1><p><strong>Rating: </strong>"+e.rating+'</p><img src="'+r+'">';t.resturantList.push(new Resturant(e.name,o,a,t.removeUndefined(e.rating),r,n,"NA","NA","NA")),google.maps.event.addListener(o,"click",function(){n.setContent(a),n.open(t.google.map,this),o.setAnimation(google.maps.Animation.BOUNCE),t.google.map.setCenter(o.getPosition())})}),google.maps.event.addListener(t.google.map,"click",function(){n.close()});for(var r=0;r<t.google.markerList.length;r++)t.bounds.extend(t.google.markerList[r].getPosition());t.google.map.fitBounds(t.bounds),t.addFSinfo(),t.jqueryBindings()}else alert("Google Places ServiceStatus Error :"+o)})}var t=this;this.currentCity=ko.observable(""),this.newcity="new york",this.bounds="",this.resturantList=ko.observableArray(),this.searchText=ko.observable(""),this.errorForsquare=!1,this.filteredList=ko.computed(function(){var e=t.searchText();return e?ko.utils.arrayFilter(t.resturantList(),function(o){if(o.infoWindow.close(),!0===t.stringStartsWith(o.name.toLowerCase(),e))return o.marker.setVisible(!0),t.stringStartsWith(o.name.toLowerCase(),e);o.marker.setVisible(!1)}):(ko.utils.arrayFilter(t.resturantList(),function(e){e.marker.setVisible(!0),this.item=ko.observable(e.name),this.showMarkerOnMap=function(e){e.infoWindow.setContent(e.info),e.infoWindow.open(t.google.map,e.marker),t.google.map.setCenter(e.marker.getPosition()),e.marker.setAnimation(google.maps.Animation.BOUNCE),$(".filter-map-content").hide(),$(".menu-button").show(),$(".responsive-menu").hide(),$(".responsive-menu").removeClass("expand")}}),t.resturantList())}),this.apiGeocodeAddress=function(e,t){geocoder=new google.maps.Geocoder,geocoder.geocode({address:e},t)},this.apiGetPlaces=function(e,t,o){"function"==typeof o&&(service=new google.maps.places.PlacesService(t),service.nearbySearch({location:e,radius:1500,type:["food"],keyword:["vegan"]},o))},this.apiFourSquare=function(e,o,n,r){var a="https://api.FourSquare.com/v2/venues/search?client_id=EDO0PU442DM5XJU3RGBJXJDOVLHTHRNJGMDQACDEFR32WHTR&client_secret=3UNC4A1BANUZHB4H0SDHZQOGDNQORSI2MGNIYXLVSMRZFYC4&v=20150321&ll="+o+","+n+"&query="+r+"&limit=1";$.getJSON(a).done(function(o){var n,r,a;try{n=o.response.venues[0].contact.formattedPhone}catch(e){n=void 0}try{a=o.response.venues[0].categories[0].shortName}catch(e){a=void 0}try{r=o.response.venues[0].url}catch(e){r=void 0}t.apicallbFourSquare(e,n,a,r)}).fail(function(e,o,n){!0!==t.errorForsquare&&(t.errorForsquare=!0,alert("issue getting FourSquare data. Error: "+o+n))})},this.apicallbFourSquare=function(e,o,n,r){e.updatefourSquareData(t.removeUndefined(o),t.removeUndefined(r),t.removeUndefined(n)),t.updateInfoWindow(e)},this.updateInfoWindow=function(e){var o;o="n/a"===e.fourSquareData[0].homepage?"<p><strong>homepage : </strong>n/a</p>":'<p><strong>homepage : </strong><a href="'+e.fourSquareData[0].homepage+'">'+e.fourSquareData[0].homepage+"</p>";var n='<div class="content"><h1>'+e.name+"</h1><p><strong>Rating: </strong>"+e.rating+"</p><p><strong>Category: </strong>"+e.fourSquareData[0].category+"</p><p><strong>Phone: </strong>"+e.fourSquareData[0].phone+"</p>"+o+'<img src="'+e.locationImg+'">';e.info=n,google.maps.event.addListener(e.marker,"click",function(){e.infoWindow.setContent(n),e.infoWindow.open(t.google.map,this),e.marker.setAnimation(google.maps.Animation.BOUNCE)})},this.addFSinfo=function(){ko.utils.arrayForEach(t.resturantList()||[],function(e){t.apiFourSquare(e,e.marker.getPosition().lat(),e.marker.getPosition().lng(),e.name)})},this.stringStartsWith=function(e,t){return e=e||"",!(t.length>e.length)&&e.substring(0,t.length)===t},this.removeUndefined=function(e){return void 0===e?"n/a":e},this.responsiveMap=function(e){t.google.map.fitBounds(t.bounds)},this.jqueryBindings=function(){$(".menu-button").click(function(){$(".filter-map").show(),$(".responsive-menu").toggleClass("expand"),$(".menu-button").hide()}),$(".close-button").click(function(){$(".filter-map").hide(),$(".menu-button").show(),$(".responsive-menu").removeClass("expand")}),$(window).bind("resize",function(e){window.resizeEvt,$(window).resize(function(){clearTimeout(window.resizeEvt),window.resizeEvt=setTimeout(function(){var e=$(window).width();t.responsiveMap(e)},500)})})},this.apiGeocodeAddress(this.newcity,function(o,n){try{t.currentCity=new City(o[0].geometry.location.lat(),o[0].geometry.location.lng())}catch(e){alert("Error loading GoogleMap. Address could not be geocoded.")}e()})};